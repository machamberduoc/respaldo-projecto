<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <title>Document</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: white;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .slide {
            width: 250px;
            background-color: #ffc107;
            display: flex;
            flex-direction: column;
            padding: 20px;
            color: #6c757d;
        }
        .slide h2 {
            margin-bottom: 20px;
        }
        .slide a {
            padding: 15px 10px;
            margin: 5px 0;
            color: white;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        .slide a:hover {
            background-color: #6c757d;
        }
        .slide a.monit {
            background-color: #ffc107;
        }
        .slide a.monit:hover {
            background-color: #6c757d;
        }
        .slide a.logout {
            margin-top: auto;
            background-color: #ffc107;
        }
        .slide a.logout:hover {
            background-color: #6c757d;
        }
        .corr {
            flex: 1;
            padding: 100px;
            overflow-y: auto;
        }
        .corr h1 {
            margin-top: 0;
            font-size: 10px;
            color: white;
        }
        .corr p {
            color: #6c757d;
        }
        .head {
            background-color: white;
            color: white;
            padding: 15px;
            text-align: right;
            position: fixed;
            top: 0;
            right: 0;
            left: 290px;
            z-index: 1000;
            display: flex;
            align-items:  center;
            justify-content:  flex-end;
        }
        .head img {
            vertical-align: middle;
            border-radius:  50%;
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }
        .head span{
            font-size: 14px;
            margin-right: 10px;
            color: #6c757d;
        }
        .corr i {
            color: #6c757d;
            padding: 10px;
        }
        .audit-table {
            width: 100%;
            border-collapse: collapse;
        }
        .audit-table th, .audit-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .audit-table th {
            background-color: #f4f4f4;
        }
        .options {
            display: none;
            position: absolute;
            top: 100%;
            right: 20px;
            background: #ffc107;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            white-space: nowrap; 
        }
        .option {
            display: block;
            padding: 10px;
            color: #f8f9fa;
            text-decoration: none;
        }
        .option:hover {
            background: #6c757d;
        }

    </style>
</head>
<body>
    <div class="slide">
        <h2>ServPred</h2>
        <a href="{% url 'welcome' %}" name="inicio">Inicio</a>
        <a href="{% url 'menu' %}" class="monit" name="menu">Menu</a>
        <a href="{% url 'monitoreo' %}" name="monitoreo">Monitoreo</a>
        <a href="{% url 'auditoria' %}" name="auditoria">Auditoria</a>
        <a href="{% url 'analisisdedatos' %}" name="analisis_datos">Analisis de datos</a>
        <a href="{% url 'analisispredictivo' %}" name="predictivo">Analisis predictivo</a>
        <a href="{% url 'recomendaciones' %}" name="recomendaciones">Recomendaciones</a>
        <a href="{% url 'logout' %}" class="logout">Cerrar Sesión</a>
    </div>
    <div class="corr"> 
        <div class="head">
            <i class="fas fa-envelope"></i>
            <span id="email">correo@correo.com</span>
            <div id="options" class="options">
                <a href="{% url 'administracion' %}" class="option">Administración</a>
                <a href="{% url 'logout' %}" class="option">Cerrar sesión</a>
            </div>
        </div>
        <div class="content-area p-4 pt-5 mt-5">
            <h2 class="mb-4" style="color: #6c757d;">Buscar Reporte Auditoria por RUT</h2>
            <div class="mb-4 form-section">
                <input type="text" class="form-control" placeholder="Buscar por RUT..." id="searchInput">
            </div>
            <br>
            <div class="form-section">
                <h2 style="color: #6c757d;">Reportes Auditoria</h2>
                <table class="audit-table">
                    <thead>
                        <tr>
                            <th style="color: #6c757d;">ID</th>
                            <th style="color: #6c757d;">Nombre Auditor</th>
                            <th style="color: #6c757d;">Rut Auditor</th>
                            <th style="color: #6c757d;">Telefono Auditor</th>
                            <th style="color: #6c757d;">Correo Auditor</th>
                            <th style="color: #6c757d;">Cargo Auditor</th>
                            <th style="color: #6c757d;">Fecha Reporte</th>
                            <th style="color: #6c757d;">Tipo Reporte</th>
                            <th style="color: #6c757d;">Motivo Reporte</th>
                        </tr>
                    </thead>
                    <table class="table">
                        <thead>
                            <tr>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                                <th style="color: #6c757d;"></th>
                            </tr>
                        </thead>
                        <tbody id="auditTableBody">
                            <!-- Las filas se agregarán aquí con JavaScript -->
                        </tbody>
                    </table>
                </table>
                <br>
                <br>
            <div class="form-section">
               
            </div>
            <br>
            <form id="auditoria-form" method="POST" action="{% url 'auditoria' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="mb-3">
                    <input type="text" class="form-control" id="nameaudit" name="nameaudit" placeholder="Nombre Auditor" required>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="ruteaudit" name="ruteaudit" placeholder="Rut Auditor" required>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="phoneaudit" name="phoneaudit" placeholder="Número Teléfono Auditor" required>
                </div>
                <div class="mb-3">
                    <input type="email" class="form-control" id="emailaudit" name="emailaudit" placeholder="Correo Auditor" required>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="companipositionaudit" name="companipositionaudit" placeholder="Cargo Auditor" required>
                </div>
                <div class="mb-3">
                    <input style="color: #6c757d;" type="date" class="form-control" id="dateaudit" name="dateaudit" required>
                </div>
                <div class="mb-3">
                    <input type="text" class="form-control" id="typeaudit" name="typeaudit" placeholder="Tipo de Reporte" required>
                </div>
                <div class="form-group">
                    <textarea class="form-control" id="textaudit" name="textaudit" rows="8" placeholder="Motivo Reporte..." required></textarea>
                </div>
                <div class="form-group">
                    <label style="color: #6c757d;" for="typedocument">Adjuntar Documento</label>
                    <input style="color: #6c757d;" type="file" class="form-control-file" id="typedocument" name="typedocument">
                </div>
                <br>
                <button type="submit" class="btn btn-secondary">Agregar Reporte</button>
            </form>
        </div>
    </div>
    <!-- Espacio para mostrar mensajes -->
    <div id="form-messages" class="mt-3"></div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>

document.addEventListener('DOMContentLoaded', function() {
    // Función para cargar los datos de auditoría ficticios
    function cargarAuditorias() {
        const data = [
            { id: 1, nameaudit: 'Juan Pérez', ruteaudit: '12345678-9', phoneaudit: '987654321', emailaudit: 'juan.perez@mail.com', companipositionaudit: 'Gerente', dateaudit: '2024-12-01', typeaudit: 'Interno', textaudit: 'Revisión anual de seguridad.' },
            { id: 2, nameaudit: 'Ana Gómez', ruteaudit: '98765432-1', phoneaudit: '912345678', emailaudit: 'ana.gomez@mail.com', companipositionaudit: 'Analista', dateaudit: '2024-11-25', typeaudit: 'Externo', textaudit: 'Auditoría externa de procesos.' },
            { id: 3, nameaudit: 'Carlos Díaz', ruteaudit: '12398765-4', phoneaudit: '932847561', emailaudit: 'carlos.diaz@mail.com', companipositionaudit: 'Director', dateaudit: '2024-11-15', typeaudit: 'Interno', textaudit: 'Verificación de cumplimiento de normas.' },
            { id: 4, nameaudit: 'Laura Martínez', ruteaudit: '75395142-7', phoneaudit: '987123456', emailaudit: 'laura.martinez@mail.com', companipositionaudit: 'Supervisor', dateaudit: '2024-12-03', typeaudit: 'Externo', textaudit: 'Revisión de auditoría de calidad.' },
            { id: 5, nameaudit: 'Pedro Fernández', ruteaudit: '74125896-3', phoneaudit: '963852741', emailaudit: 'pedro.fernandez@mail.com', companipositionaudit: 'Consultor', dateaudit: '2024-11-20', typeaudit: 'Interno', textaudit: 'Revisión de procesos operativos.' }
        ];

        let tableBody = document.getElementById('auditTableBody');
        tableBody.innerHTML = '';  // Limpiar el contenido existente

        data.forEach(auditoria => {
            let row = document.createElement('tr');
            row.innerHTML = `
                <td style="color: #6c757d;">${auditoria.id}</td>
                <td style="color: #6c757d;">${auditoria.nameaudit}</td>
                <td style="color: #6c757d;">${auditoria.ruteaudit}</td>
                <td style="color: #6c757d;">${auditoria.phoneaudit}</td>
                <td style="color: #6c757d;">${auditoria.emailaudit}</td>
                <td style="color: #6c757d;">${auditoria.companipositionaudit}</td>
                <td style="color: #6c757d;">${auditoria.dateaudit}</td>
                <td style="color: #6c757d;">${auditoria.typeaudit}</td>
                <td style="color: #6c757d;">${auditoria.textaudit}</td>
            `;
            tableBody.appendChild(row);
        });
    }

    cargarAuditorias();  // Cargar los datos al iniciar la página

    // Búsqueda por RUT
    const searchInput = document.getElementById('searchInput');
    searchInput.addEventListener('keyup', function() {
        const filter = searchInput.value.toLowerCase();
        const rows = document.querySelectorAll('#auditTableBody tr');
        
        rows.forEach(row => {
            const rutCell = row.querySelectorAll('td')[2]; // Columna de RUT
            if (rutCell && rutCell.textContent.toLowerCase().includes(filter)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });

    // Formulario de auditoría
    document.getElementById('auditoria-form').addEventListener('submit', function(event) {
        event.preventDefault();

        let form = document.getElementById('auditoria-form');
        let formData = new FormData(form);

        // Enviar la solicitud AJAX
        fetch("{% url 'auditoria' %}", {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            let messagesDiv = document.getElementById('form-messages');
            if (data.status === 'success') {
                messagesDiv.innerHTML = `<div class='sendmessaje' style="color: #6c757d;">Mensaje enviado Exitosamente</div>`;
                form.reset();  // Limpiar el formulario
            } else {
                messagesDiv.innerHTML = `<div style="color: #6c757d;">${data.message}</div>`;
            }
        })
        .catch(error => {
            document.getElementById('form-messages').innerHTML = `<div style="color: #6c757d;">Error en la solicitud.</div>`;
        });
    });
});


        document.addEventListener("DOMContentLoaded", function() {
            // Hacer una solicitud a la API para obtener los datos del usuario autenticado
            fetch('/api/usuarios/')
            .then(response => response.json())
            .then(data => {
                // Si se ha autenticado correctamente y existe el correo
                if (data && data.correo) {
                    // Seleccionar el elemento del correo en el div .head
                    let correoElement = document.querySelector('.head span');
                    // Reemplazar el texto del span con el correo del usuario autenticado
                    correoElement.textContent = data.correo;
                } else {
                    console.log('No se ha autenticado ningún usuario');
                }
            })
            .catch(error => console.log('Error:', error));
        });
        document.addEventListener('DOMContentLoaded', function() {
    const email = document.getElementById('email');
    const options = document.getElementById('options');

    email.addEventListener('click', function(event) {
        event.stopPropagation(); // Evita que el clic se propague a otros elementos
        if (options.style.display === 'block') {
            options.style.display = 'none';
        } else {
            options.style.display = 'block';
        }
    });
    document.addEventListener('click', function(event) {
        if (!email.contains(event.target) && !options.contains(event.target)) {
            options.style.display = 'none';
        }
    });
});
    </script>
</body>
</html>


